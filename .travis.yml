language: go
go: 
 - "1.10"

addons:
  apt:
    update: true
    packages:
      - gcc-7-multilib-i686-linux-gnu
      - gcc-mingw-w64-i686
      - zlib1g-dev:i386
      - libz-mingw-w64-dev
      - gcc-7-arm-linux-gnueabihf
      - clang

script:
 - make clean
 - make build-deps
 - make deps
 - make generate
 - make test
 - make build

addons:
  apt:
    packages:
      - dos2unix

deploy:
  provider: script
  script: /bin/bash $TRAVIS_BUILD_DIR/release.sh
  skip_cleanup: true
  on:
    tags: true
branch: master